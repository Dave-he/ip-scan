<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IP Scan Dashboard</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="toast-container"></div>
    
    <div class="container">
        <header>
            <h1>🔍 IP 扫描控制台</h1>
            <div id="status-bar">
                <span class="status-item">
                    <span class="status-label">扫描状态</span>
                    <span id="scan-status" class="status-badge status-unknown">未知</span>
                </span>
                <span class="status-item">
                    <span class="status-label">当前轮次</span>
                    <b id="scan-round">-</b>
                </span>
                <span class="status-item">
                    <span class="status-label">扫描ID</span>
                    <span id="scan-id" class="scan-id-text">-</span>
                </span>
            </div>
        </header>

        <section class="config-section">
            <div class="config-header">
                <h2>⚙️ 扫描配置</h2>
                <button onclick="toggleConfig()" class="btn-toggle" id="btn-toggle">
                    <span id="toggle-icon">▼</span>
                </button>
            </div>
            <div class="config-panel" id="config-panel">
                <div class="config-grid">
                    <div class="config-item">
                        <label for="start-ip">起始 IP</label>
                        <input type="text" id="start-ip" placeholder="0.0.0.0" value="0.0.0.0">
                    </div>
                    <div class="config-item">
                        <label for="end-ip">结束 IP</label>
                        <input type="text" id="end-ip" placeholder="255.255.255.255" value="255.255.255.255">
                    </div>
                    <div class="config-item">
                        <label for="ports">端口</label>
                        <input type="text" id="ports" placeholder="80,443,8080" value="80">
                    </div>
                    <div class="config-item">
                        <label for="timeout">超时 (ms)</label>
                        <input type="number" id="timeout" placeholder="500" value="500" min="100" max="5000">
                    </div>
                    <div class="config-item">
                        <label for="concurrency">并发数</label>
                        <input type="number" id="concurrency" placeholder="100" value="100" min="10" max="1000">
                    </div>
                    <div class="config-item config-checkbox">
                        <label>
                            <input type="checkbox" id="skip-private"> 跳过私有IP
                        </label>
                    </div>
                </div>
            </div>
        </section>

        <section class="controls">
            <button id="btn-start" onclick="startScan()" class="btn-primary">
                <span class="btn-icon">▶️</span> 开始扫描
            </button>
            <button id="btn-stop" onclick="stopScan()" class="btn-danger" disabled>
                <span class="btn-icon">⏸️</span> 停止扫描
            </button>
            <button onclick="fetchResults(1)" class="btn-secondary">
                <span class="btn-icon">🔄</span> 刷新数据
            </button>
        </section>


        <section class="stats-cards">
            <div class="card">
                <div class="card-icon">📊</div>
                <h3>总开放端口数</h3>
                <p id="stat-total" class="stat-number">0</p>
            </div>
            <div class="card">
                <div class="card-icon">🌐</div>
                <h3>独立 IP 数</h3>
                <p id="stat-unique" class="stat-number">0</p>
            </div>
            <div class="card">
                <div class="card-icon">🎯</div>
                <h3>最热门端口</h3>
                <p id="stat-top-port" class="stat-text">-</p>
            </div>
        </section>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('results')">扫描结果</button>
            <button class="tab-btn" onclick="switchTab('history')">扫描历史</button>
        </div>

        <section id="tab-results" class="tab-content active">
            <div class="table-controls">
                <button onclick="exportData('csv')" class="btn-secondary">
                    <span class="btn-icon">📄</span> 导出 CSV
                </button>
                 <button onclick="exportData('json')" class="btn-secondary">
                    <span class="btn-icon">📄</span> 导出 JSON
                </button>
            </div>
            <div class="table-responsive">
                <table id="results-table">
                    <thead>
                        <tr>
                            <th>IP 地址</th>
                            <th>端口</th>
                            <th>类型</th>
                            <th>地理位置</th>
                            <th>扫描轮次</th>
                            <th>首次发现时间</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
            <div class="pagination">
                <button id="prev-page" onclick="changePage(-1)" disabled>上一页</button>
                <span id="page-info">第 1 页</span>
                <button id="next-page" onclick="changePage(1)" disabled>下一页</button>
            </div>
        </section>

        <section id="tab-history" class="tab-content">
             <div class="table-controls">
                <button onclick="fetchHistory()" class="btn-secondary">
                    <span class="btn-icon">🔄</span> 刷新历史
                </button>
             </div>
             <div class="table-responsive">
                <table id="history-table">
                    <thead>
                        <tr>
                            <th>扫描轮次</th>
                            <th>开始时间</th>
                            <th>结束时间</th>
                            <th>状态</th>
                            <th>扫描详情</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Populated by JS -->
                    </tbody>
                </table>
            </div>
        </section>
    </div>
    <script src="app.js"></script>
</body>
</html>
